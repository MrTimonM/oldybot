<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Pastebin</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        textarea {
            width: 100%;
            height: 150px;
            margin-bottom: 10px;
        }
        #message {
            color: green;
        }
        #password-section {
            display: none;
        }
    </style>
</head>
<body>
    <h1>Secure Pastebin</h1>
    
    <textarea id="pasteArea" placeholder="Enter your text here..."></textarea>
    
    <div id="password-section">
        <input type="password" id="password" placeholder="Enter password to save/edit">
        <button onclick="verifyPassword()">Submit</button>
    </div>
    
    <button onclick="savePaste()">Save</button>
    <button onclick="editPaste()">Edit</button>
    
    <div id="message"></div>
    
    <script>
        const pasteID = window.location.pathname.split("/")[1];
        let isAuthenticated = false; // Tracks if the user entered the correct password
        
        function savePaste() {
            const pasteText = document.getElementById("pasteArea").value;
            const password = prompt("Set a password for this paste:");
            
            if (password) {
                if (pasteID) {
                    localStorage.setItem(pasteID, JSON.stringify({ text: pasteText, password: password }));
                    document.getElementById("message").textContent = "Paste saved!";
                } else {
                    const newID = Math.random().toString(36).substr(2, 8);
                    localStorage.setItem(newID, JSON.stringify({ text: pasteText, password: password }));
                    window.history.pushState(null, "", "/" + newID);
                    document.getElementById("message").textContent = "Paste saved at URL: " + window.location.href;
                }
            } else {
                document.getElementById("message").textContent = "Error: Password is required to save the paste.";
            }
        }
        
        function editPaste() {
            const newText = document.getElementById("pasteArea").value;
            
            if (pasteID && localStorage.getItem(pasteID)) {
                const storedData = JSON.parse(localStorage.getItem(pasteID));
                
                if (isAuthenticated || confirmPassword(storedData.password)) {
                    localStorage.setItem(pasteID, JSON.stringify({ text: newText, password: storedData.password }));
                    document.getElementById("message").textContent = "Paste edited!";
                } else {
                    document.getElementById("message").textContent = "Error: Incorrect password.";
                }
            } else {
                document.getElementById("message").textContent = "Error: No paste found to edit.";
            }
        }

        function confirmPassword(storedPassword) {
            const enteredPassword = prompt("Enter the password to edit this paste:");
            if (enteredPassword === storedPassword) {
                isAuthenticated = true;
                return true;
            }
            return false;
        }

        function verifyPassword() {
            const enteredPassword = document.getElementById("password").value;
            const storedData = JSON.parse(localStorage.getItem(pasteID));
            
            if (enteredPassword === storedData.password) {
                isAuthenticated = true;
                document.getElementById("password-section").style.display = "none";
                document.getElementById("message").textContent = "Password verified. You can now edit the paste.";
            } else {
                document.getElementById("message").textContent = "Incorrect password!";
            }
        }

        function loadPaste() {
            if (pasteID && localStorage.getItem(pasteID)) {
                const storedData = JSON.parse(localStorage.getItem(pasteID));
                document.getElementById("pasteArea").value = storedData.text;
                document.getElementById("password-section").style.display = "block";
            }
        }

        window.onload = loadPaste;
    </script>
</body>
</html>
